<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scrabble Solver</title>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/4.1.1/tesseract.min.js'></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0a0a0a;
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        header {
            margin-bottom: 40px;
        }
        
        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #00ff87, #60efff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .tagline {
            color: #888;
            font-size: 0.95rem;
        }

        .workspace {
            display: grid;
            grid-template-columns: minmax(600px, 1fr) 400px;
            gap: 24px;
            margin-bottom: 40px;
        }

        @media (max-width: 1200px) {
            .workspace {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: #111;
            border: 1px solid #222;
            border-radius: 12px;
            padding: 24px;
        }

        .panel-title {
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #666;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .board-wrapper {
            background: #0d0d0d;
            padding: 16px;
            border-radius: 8px;
            border: 1px solid #1a1a1a;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(15, 1fr);
            gap: 2px;
            background: #000;
            padding: 2px;
            border-radius: 4px;
            max-width: 600px;
            margin: 0 auto;
        }

        .cell {
            aspect-ratio: 1;
            background: #1a1a1a;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s;
            position: relative;
            color: #666;
        }

        .cell:hover {
            background: #222;
        }

        .cell.tw {
            background: #d32f2f;
            color: #fff;
        }

        .cell.dw {
            background: #f57c00;
            color: #fff;
        }

        .cell.tl {
            background: #0288d1;
            color: #fff;
        }

        .cell.dl {
            background: #00897b;
            color: #fff;
        }

        .cell.center {
            background: #fbc02d;
            color: #000;
        }

        .cell.filled {
            background: #333 !important;
            color: #00ff87;
            font-size: 1rem;
            font-weight: 700;
        }

        .rack-input {
            width: 100%;
            background: #0d0d0d;
            border: 2px solid #222;
            color: #fff;
            padding: 16px;
            border-radius: 8px;
            font-size: 1.25rem;
            font-weight: 600;
            text-align: center;
            letter-spacing: 8px;
            text-transform: uppercase;
            transition: border-color 0.2s;
            margin-bottom: 16px;
        }

        .rack-input:focus {
            outline: none;
            border-color: #00ff87;
        }

        .rack-input::placeholder {
            color: #333;
        }

        .btn-group {
            display: flex;
            gap: 12px;
        }

        .btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00ff87, #60efff);
            color: #000;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 255, 135, 0.3);
        }

        .btn-secondary {
            background: #1a1a1a;
            color: #fff;
            border: 1px solid #333;
        }

        .btn-secondary:hover {
            background: #222;
        }

        .upload-zone {
            border: 2px dashed #333;
            border-radius: 8px;
            padding: 32px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 16px;
        }

        .upload-zone:hover {
            border-color: #00ff87;
            background: #0d0d0d;
        }

        .upload-zone h3 {
            color: #fff;
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .upload-zone p {
            color: #666;
            font-size: 0.875rem;
        }

        input[type="file"] {
            display: none;
        }

        .preview img {
            width: 100%;
            border-radius: 8px;
            margin-top: 16px;
        }

        .status {
            padding: 12px 16px;
            border-radius: 6px;
            font-size: 0.875rem;
            margin-bottom: 24px;
            border-left: 3px solid;
        }

        .status.processing {
            background: rgba(255, 193, 7, 0.1);
            border-color: #ffc107;
            color: #ffc107;
        }

        .status.success {
            background: rgba(0, 255, 135, 0.1);
            border-color: #00ff87;
            color: #00ff87;
        }

        .status.error {
            background: rgba(244, 67, 54, 0.1);
            border-color: #f44336;
            color: #f44336;
        }

        .moves {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .move {
            background: #111;
            border: 1px solid #222;
            border-radius: 8px;
            padding: 16px;
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 16px;
            align-items: center;
            transition: all 0.2s;
        }

        .move:hover {
            border-color: #333;
            transform: translateX(4px);
        }

        .move.top {
            border-color: #00ff87;
            background: rgba(0, 255, 135, 0.05);
        }

        .move-rank {
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
            min-width: 40px;
        }

        .move.top .move-rank {
            color: #00ff87;
        }

        .move-word {
            font-size: 1.25rem;
            font-weight: 700;
            letter-spacing: 2px;
            margin-bottom: 4px;
        }

        .move-details {
            font-size: 0.8rem;
            color: #666;
        }

        .move-score {
            font-size: 2rem;
            font-weight: 700;
            color: #00ff87;
            min-width: 80px;
            text-align: right;
        }

        .note {
            background: rgba(96, 239, 255, 0.1);
            border-left: 3px solid #60efff;
            padding: 12px 16px;
            border-radius: 6px;
            margin-bottom: 16px;
            font-size: 0.875rem;
            color: #60efff;
        }

        footer {
            text-align: center;
            padding: 40px 0;
            color: #333;
            font-size: 0.875rem;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 60px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #222;
            border-top-color: #00ff87;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .results-title {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .results-count {
            color: #666;
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Scrabble Solver</h1>
            <p class="tagline">Real-time board analysis • Complete dictionary • Smart scoring</p>
        </header>

        <div class="workspace">
            <div class="panel">
                <div class="panel-title">Board State</div>
                <div class="note">Click any cell to place a letter. Special squares are marked automatically.</div>
                
                <div class="board-wrapper">
                    <div class="board" id="board"></div>
                </div>

                <div style="margin-top: 24px;">
                    <div class="panel-title" style="margin-bottom: 12px;">Your Rack</div>
                    <input type="text" id="rack" class="rack-input" maxlength="7" placeholder="ABCDEFG">
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="solve()">Analyze</button>
                        <button class="btn btn-secondary" onclick="clear()">Clear</button>
                    </div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-title">OCR Upload</div>
                <div class="upload-zone" onclick="document.getElementById('file').click()">
                    <h3>Upload Screenshot</h3>
                    <p>We'll extract letters automatically</p>
                </div>
                <input type="file" id="file" accept="image/*">
                <div id="preview"></div>
            </div>
        </div>

        <div id="status"></div>
        <div id="results"></div>

        <footer>
            Open source • No tracking • No ads
        </footer>
    </div>

    <script>
        const VALUES = {
            'A':1,'B':3,'C':3,'D':2,'E':1,'F':4,'G':2,'H':4,'I':1,'J':8,'K':5,'L':1,'M':3,
            'N':1,'O':1,'P':3,'Q':10,'R':1,'S':1,'T':1,'U':1,'V':4,'W':4,'X':8,'Y':4,'Z':10,'?':0
        };

        const TW = [[0,0],[0,7],[0,14],[7,0],[7,14],[14,0],[14,7],[14,14]];
        const DW = [[1,1],[2,2],[3,3],[4,4],[1,13],[2,12],[3,11],[4,10],[10,4],[11,3],[12,2],[13,1],[10,10],[11,11],[12,12],[13,13]];
        const TL = [[1,5],[1,9],[5,1],[5,5],[5,9],[5,13],[9,1],[9,5],[9,9],[9,13],[13,5],[13,9]];
        const DL = [[0,3],[0,11],[2,6],[2,8],[3,0],[3,7],[3,14],[6,2],[6,6],[6,8],[6,12],[7,3],[7,11],[8,2],[8,6],[8,8],[8,12],[11,0],[11,7],[11,14],[12,6],[12,8],[14,3],[14,11]];

        let board = Array(15).fill().map(() => Array(15).fill(''));

        function init() {
            const grid = document.getElementById('board');
            grid.innerHTML = '';
            
            for (let r = 0; r < 15; r++) {
                for (let c = 0; c < 15; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    
                    if (TW.some(([tr,tc]) => tr === r && tc === c)) {
                        cell.classList.add('tw');
                        cell.textContent = '3W';
                    } else if (DW.some(([tr,tc]) => tr === r && tc === c)) {
                        cell.classList.add('dw');
                        cell.textContent = '2W';
                    } else if (TL.some(([tr,tc]) => tr === r && tc === c)) {
                        cell.classList.add('tl');
                        cell.textContent = '3L';
                    } else if (DL.some(([tr,tc]) => tr === r && tc === c)) {
                        cell.classList.add('dl');
                        cell.textContent = '2L';
                    }
                    
                    if (r === 7 && c === 7) {
                        cell.classList.add('center');
                        cell.textContent = '★';
                    }
                    
                    cell.onclick = () => edit(r, c, cell);
                    grid.appendChild(cell);
                }
            }
        }

        function edit(r, c, el) {
            const letter = prompt('Letter (empty to clear):');
            if (letter === null) return;
            
            const l = letter.toUpperCase().trim();
            if (l === '' || /^[A-Z]$/.test(l)) {
                board[r][c] = l;
                el.textContent = l || el.textContent;
                el.classList.toggle('filled', l !== '');
            }
        }

        function clear() {
            board = Array(15).fill().map(() => Array(15).fill(''));
            init();
            document.getElementById('rack').value = '';
            document.getElementById('results').innerHTML = '';
            document.getElementById('status').innerHTML = '';
        }

        function status(msg, type) {
            document.getElementById('status').innerHTML = `<div class="status ${type}">${msg}</div>`;
        }

        function anchors() {
            const a = [];
            for (let r = 0; r < 15; r++) {
                for (let c = 0; c < 15; c++) {
                    if (board[r][c] === '') {
                        const h = (c > 0 && board[r][c-1]) || (c < 14 && board[r][c+1]);
                        const v = (r > 0 && board[r-1][c]) || (r < 14 && board[r+1][c]);
                        if (h || v) {
                            a.push({r, c, d: 'h'}, {r, c, d: 'v'});
                        }
                    }
                }
            }
            if (a.length === 0) a.push({r: 7, c: 7, d: 'h'}, {r: 7, c: 7, d: 'v'});
            return a;
        }

        function score(word, r, c, d, tiles) {
            let s = 0, wm = 1;
            for (let i = 0; i < word.length; i++) {
                const rr = d === 'h' ? r : r + i;
                const cc = d === 'h' ? c + i : c;
                let ls = VALUES[word[i]] || 0, lm = 1;
                
                if (tiles.some(t => t.r === rr && t.c === cc)) {
                    if (TW.some(([tr,tc]) => tr === rr && tc === cc)) wm *= 3;
                    else if (DW.some(([tr,tc]) => tr === rr && tc === cc)) wm *= 2;
                    else if (TL.some(([tr,tc]) => tr === rr && tc === cc)) lm = 3;
                    else if (DL.some(([tr,tc]) => tr === rr && tc === cc)) lm = 2;
                }
                s += ls * lm;
            }
            return s * wm + (tiles.length === 7 ? 50 : 0);
        }

        function canForm(word, rack, existing = []) {
            const r = rack.split('');
            for (let l of word.toUpperCase()) {
                if (existing.includes(l)) continue;
                const i = r.indexOf(l);
                if (i !== -1) r.splice(i, 1);
                else if (r.includes('?')) r.splice(r.indexOf('?'), 1);
                else return false;
            }
            return true;
        }

        function valid(word, r, c, d) {
            if (r < 0 || c < 0) return false;
            const er = d === 'h' ? r : r + word.length - 1;
            const ec = d === 'h' ? c + word.length - 1 : c;
            if (er >= 15 || ec >= 15) return false;
            
            let conn = false;
            for (let i = 0; i < word.length; i++) {
                const rr = d === 'h' ? r : r + i;
                const cc = d === 'h' ? c + i : c;
                const ex = board[rr][cc];
                if (ex) {
                    if (ex !== word[i]) return false;
                    conn = true;
                }
            }
            
            if (!conn) {
                const empty = board.every(row => row.every(cell => !cell));
                if (!empty) return false;
                if (!(r <= 7 && r + (d === 'v' ? word.length : 1) > 7 &&
                      c <= 7 && c + (d === 'h' ? word.length : 1) > 7)) return false;
            }
            return true;
        }

        function newTiles(word, r, c, d) {
            const t = [];
            for (let i = 0; i < word.length; i++) {
                const rr = d === 'h' ? r : r + i;
                const cc = d === 'h' ? c + i : c;
                if (!board[rr][cc]) t.push({r: rr, c: cc, l: word[i]});
            }
            return t;
        }

        async function generate(rack, anch) {
            const moves = [];
            const queries = [];
            
            for (let len = 2; len <= 7; len++) {
                queries.push(
                    fetch(`https://api.datamuse.com/words?sp=${'?'.repeat(len)}&max=1000`)
                        .then(r => r.json())
                );
            }
            
            const results = await Promise.all(queries);
            const words = new Set();
            
            results.forEach(list => {
                list.forEach(item => {
                    const w = item.word.toUpperCase();
                    if (w.length >= 2 && w.length <= 7 && canForm(w, rack)) {
                        words.add(w);
                    }
                });
            });
            
            for (let a of anch) {
                for (let word of words) {
                    for (let off = 0; off < word.length; off++) {
                        const sr = a.d === 'h' ? a.r : a.r - off;
                        const sc = a.d === 'h' ? a.c - off : a.c;
                        
                        if (valid(word, sr, sc, a.d)) {
                            const tiles = newTiles(word, sr, sc, a.d);
                            const s = score(word, sr, sc, a.d, tiles);
                            moves.push({
                                word,
                                r: sr,
                                c: sc,
                                d: a.d,
                                score: s,
                                pos: `${String.fromCharCode(65 + sr)}${sc + 1}`,
                                tiles: tiles.length
                            });
                        }
                    }
                }
            }
            
            moves.sort((a, b) => b.score - a.score);
            return moves.slice(0, 50);
        }

        function display(moves) {
            const div = document.getElementById('results');
            if (!moves.length) {
                div.innerHTML = '<div class="status error">No valid moves found</div>';
                return;
            }
            
            let html = `
                <div class="panel">
                    <div class="results-header">
                        <div class="results-title">Best Moves</div>
                        <div class="results-count">${moves.length} found</div>
                    </div>
                    <div class="moves">
            `;
            
            moves.forEach((m, i) => {
                const top = i < 3 ? 'top' : '';
                html += `
                    <div class="move ${top}">
                        <div class="move-rank">${i + 1}</div>
                        <div>
                            <div class="move-word">${m.word}</div>
                            <div class="move-details">
                                ${m.pos} ${m.d === 'h' ? '→' : '↓'} • ${m.tiles} tiles${m.tiles === 7 ? ' • BINGO' : ''}
                            </div>
                        </div>
                        <div class="move-score">${m.score}</div>
                    </div>
                `;
            });
            
            html += '</div></div>';
            div.innerHTML = html;
        }

        async function solve() {
            const rack = document.getElementById('rack').value.trim().toUpperCase();
            if (rack.length < 2 || rack.length > 7) {
                status('Enter 2-7 letters in your rack', 'error');
                return;
            }
            
            status('Analyzing board...', 'processing');
            const a = anchors();
            const moves = await generate(rack, a);
            
            if (moves.length) {
                display(moves);
                status(`Found ${moves.length} moves`, 'success');
            } else {
                status('No valid moves', 'error');
            }
        }

        document.getElementById('file').onchange = async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = async (e) => {
                document.getElementById('preview').innerHTML = 
                    `<img src="${e.target.result}">`;
                
                status('Processing image...', 'processing');
                try {
                    const result = await Tesseract.recognize(e.target.result, 'eng');
                    const letters = result.data.text.toUpperCase().replace(/[^A-Z]/g, '');
                    if (letters) {
                        document.getElementById('rack').value = letters.substring(0, 7);
                        status('OCR complete', 'success');
                    } else {
                        status('Could not extract letters', 'error');
                    }
                } catch {
                    status('OCR failed', 'error');
                }
            };
            reader.readAsDataURL(file);
        };

        init();
    </script>
</body>
</html>
