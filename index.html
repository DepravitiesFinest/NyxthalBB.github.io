<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scrabble Solver</title>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/4.1.1/tesseract.min.js'></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0a0a0a;
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        header {
            margin-bottom: 40px;
        }
        
        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #00ff87, #60efff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .tagline {
            color: #888;
            font-size: 0.95rem;
        }

        .workspace {
            display: grid;
            grid-template-columns: minmax(650px, 1fr) 450px;
            gap: 24px;
            margin-bottom: 40px;
        }

        @media (max-width: 1200px) {
            .workspace {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: #111;
            border: 1px solid #222;
            border-radius: 12px;
            padding: 24px;
        }

        .panel-title {
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #666;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .board-wrapper {
            background: #0d0d0d;
            padding: 16px;
            border-radius: 8px;
            border: 1px solid #1a1a1a;
            position: relative;
        }

        .board-coords {
            display: flex;
            justify-content: space-around;
            color: #333;
            font-size: 0.7rem;
            font-weight: 600;
            margin-bottom: 4px;
            padding-left: 18px;
        }

        .board-row-wrapper {
            display: flex;
            gap: 4px;
        }

        .board-row-label {
            width: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(15, 1fr);
            gap: 2px;
            background: #000;
            padding: 2px;
            border-radius: 4px;
            flex: 1;
        }

        .cell {
            aspect-ratio: 1;
            background: #1a1a1a;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s;
            position: relative;
            color: #666;
        }

        .cell:hover {
            background: #222;
            transform: scale(1.05);
            z-index: 10;
        }

        .cell.tw { background: #d32f2f; color: #fff; }
        .cell.dw { background: #f57c00; color: #fff; }
        .cell.tl { background: #0288d1; color: #fff; }
        .cell.dl { background: #00897b; color: #fff; }
        .cell.center { background: #fbc02d; color: #000; }

        .cell.filled {
            background: #333 !important;
            color: #fff;
            font-size: 1.1rem;
            font-weight: 700;
        }

        .cell.preview {
            background: #00ff87 !important;
            color: #000;
            font-size: 1.1rem;
            font-weight: 700;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .rack-input {
            width: 100%;
            background: #0d0d0d;
            border: 2px solid #222;
            color: #fff;
            padding: 16px;
            border-radius: 8px;
            font-size: 1.25rem;
            font-weight: 600;
            text-align: center;
            letter-spacing: 8px;
            text-transform: uppercase;
            transition: border-color 0.2s;
            margin-bottom: 16px;
        }

        .rack-input:focus {
            outline: none;
            border-color: #00ff87;
        }

        .rack-input::placeholder {
            color: #333;
        }

        .btn-group {
            display: flex;
            gap: 12px;
        }

        .btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00ff87, #60efff);
            color: #000;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 255, 135, 0.3);
        }

        .btn-secondary {
            background: #1a1a1a;
            color: #fff;
            border: 1px solid #333;
        }

        .btn-secondary:hover {
            background: #222;
        }

        .upload-zone {
            border: 2px dashed #333;
            border-radius: 8px;
            padding: 32px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 16px;
        }

        .upload-zone:hover {
            border-color: #00ff87;
            background: #0d0d0d;
        }

        .upload-zone h3 {
            color: #fff;
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .upload-zone p {
            color: #666;
            font-size: 0.875rem;
        }

        input[type="file"] {
            display: none;
        }

        .preview img {
            width: 100%;
            border-radius: 8px;
            margin-top: 16px;
        }

        .status {
            padding: 12px 16px;
            border-radius: 6px;
            font-size: 0.875rem;
            margin-bottom: 24px;
            border-left: 3px solid;
        }

        .status.processing {
            background: rgba(255, 193, 7, 0.1);
            border-color: #ffc107;
            color: #ffc107;
        }

        .status.success {
            background: rgba(0, 255, 135, 0.1);
            border-color: #00ff87;
            color: #00ff87;
        }

        .status.error {
            background: rgba(244, 67, 54, 0.1);
            border-color: #f44336;
            color: #f44336;
        }

        .moves {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 600px;
            overflow-y: auto;
        }

        .moves::-webkit-scrollbar {
            width: 8px;
        }

        .moves::-webkit-scrollbar-track {
            background: #0d0d0d;
            border-radius: 4px;
        }

        .moves::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 4px;
        }

        .move {
            background: #111;
            border: 1px solid #222;
            border-radius: 8px;
            padding: 16px;
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 16px;
            align-items: center;
            transition: all 0.2s;
            cursor: pointer;
        }

        .move:hover {
            border-color: #00ff87;
            transform: translateX(4px);
        }

        .move.active {
            border-color: #00ff87;
            background: rgba(0, 255, 135, 0.1);
        }

        .move-rank {
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
            min-width: 40px;
        }

        .move.active .move-rank {
            color: #00ff87;
        }

        .move-word {
            font-size: 1.25rem;
            font-weight: 700;
            letter-spacing: 2px;
            margin-bottom: 4px;
        }

        .move-details {
            font-size: 0.8rem;
            color: #666;
        }

        .move-score {
            font-size: 2rem;
            font-weight: 700;
            color: #00ff87;
            min-width: 80px;
            text-align: right;
        }

        .note {
            background: rgba(96, 239, 255, 0.1);
            border-left: 3px solid #60efff;
            padding: 12px 16px;
            border-radius: 6px;
            margin-bottom: 16px;
            font-size: 0.875rem;
            color: #60efff;
        }

        footer {
            text-align: center;
            padding: 40px 0;
            color: #333;
            font-size: 0.875rem;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 60px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #222;
            border-top-color: #00ff87;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .results-title {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .results-count {
            color: #666;
            font-size: 0.875rem;
        }

        .legend {
            display: flex;
            gap: 16px;
            margin-top: 12px;
            font-size: 0.8rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #666;
        }

        .legend-box {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .legend-box.existing {
            background: #333;
        }

        .legend-box.new {
            background: #00ff87;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Scrabble Solver</h1>
            <p class="tagline">Real-time board analysis • Complete dictionary • Smart scoring</p>
        </header>

        <div class="workspace">
            <div class="panel">
                <div class="panel-title">Board State</div>
                <div class="note">Click cells to enter existing letters. Top move will be highlighted automatically.</div>
                
                <div class="board-wrapper">
                    <div class="board-coords">
                        <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span><span>8</span><span>9</span><span>10</span><span>11</span><span>12</span><span>13</span><span>14</span><span>15</span>
                    </div>
                    <div id="board-container"></div>
                </div>

                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-box existing"></div>
                        <span>Existing tiles</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box new"></div>
                        <span>Suggested move</span>
                    </div>
                </div>

                <div style="margin-top: 24px;">
                    <div class="panel-title" style="margin-bottom: 12px;">Your Rack</div>
                    <input type="text" id="rack" class="rack-input" maxlength="7" placeholder="ABCDEFG">
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="solve()">Analyze</button>
                        <button class="btn btn-secondary" onclick="clear()">Clear</button>
                    </div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-title">Best Moves</div>
                <div class="note">Click any move to preview it on the board</div>
                <div id="results"></div>
            </div>
        </div>

        <div id="status"></div>

        <footer>
            Open source • No tracking • No ads
        </footer>
    </div>

    <script>
        const VALUES = {
            'A':1,'B':3,'C':3,'D':2,'E':1,'F':4,'G':2,'H':4,'I':1,'J':8,'K':5,'L':1,'M':3,
            'N':1,'O':1,'P':3,'Q':10,'R':1,'S':1,'T':1,'U':1,'V':4,'W':4,'X':8,'Y':4,'Z':10,'?':0
        };

        const TW = [[0,0],[0,7],[0,14],[7,0],[7,14],[14,0],[14,7],[14,14]];
        const DW = [[1,1],[2,2],[3,3],[4,4],[1,13],[2,12],[3,11],[4,10],[10,4],[11,3],[12,2],[13,1],[10,10],[11,11],[12,12],[13,13]];
        const TL = [[1,5],[1,9],[5,1],[5,5],[5,9],[5,13],[9,1],[9,5],[9,9],[9,13],[13,5],[13,9]];
        const DL = [[0,3],[0,11],[2,6],[2,8],[3,0],[3,7],[3,14],[6,2],[6,6],[6,8],[6,12],[7,3],[7,11],[8,2],[8,6],[8,8],[8,12],[11,0],[11,7],[11,14],[12,6],[12,8],[14,3],[14,11]];

        let board = Array(15).fill().map(() => Array(15).fill(''));
        let cells = [];
        let currentMoves = [];
        let activeMove = null;

        function init() {
            const container = document.getElementById('board-container');
            container.innerHTML = '';
            cells = [];
            
            for (let r = 0; r < 15; r++) {
                const rowWrapper = document.createElement('div');
                rowWrapper.className = 'board-row-wrapper';
                
                const label = document.createElement('div');
                label.className = 'board-row-label';
                label.textContent = String.fromCharCode(65 + r);
                rowWrapper.appendChild(label);
                
                const rowGrid = document.createElement('div');
                rowGrid.className = 'board';
                
                for (let c = 0; c < 15; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.r = r;
                    cell.dataset.c = c;
                    
                    if (TW.some(([tr,tc]) => tr === r && tc === c)) {
                        cell.classList.add('tw');
                        cell.textContent = '3W';
                    } else if (DW.some(([tr,tc]) => tr === r && tc === c)) {
                        cell.classList.add('dw');
                        cell.textContent = '2W';
                    } else if (TL.some(([tr,tc]) => tr === r && tc === c)) {
                        cell.classList.add('tl');
                        cell.textContent = '3L';
                    } else if (DL.some(([tr,tc]) => tr === r && tc === c)) {
                        cell.classList.add('dl');
                        cell.textContent = '2L';
                    }
                    
                    if (r === 7 && c === 7) {
                        cell.classList.add('center');
                        cell.textContent = '★';
                    }
                    
                    cell.onclick = () => edit(r, c, cell);
                    rowGrid.appendChild(cell);
                    if (!cells[r]) cells[r] = [];
                    cells[r][c] = cell;
                }
                
                rowWrapper.appendChild(rowGrid);
                container.appendChild(rowWrapper);
            }
        }

        function edit(r, c, el) {
            const letter = prompt('Letter (empty to clear):');
            if (letter === null) return;
            
            const l = letter.toUpperCase().trim();
            if (l === '' || /^[A-Z]$/.test(l)) {
                board[r][c] = l;
                updateCell(r, c);
            }
        }

        function updateCell(r, c) {
            const cell = cells[r][c];
            const letter = board[r][c];
            
            if (letter) {
                cell.textContent = letter;
                cell.classList.add('filled');
                cell.classList.remove('preview');
            } else {
                // Restore original label
                if (TW.some(([tr,tc]) => tr === r && tc === c)) cell.textContent = '3W';
                else if (DW.some(([tr,tc]) => tr === r && tc === c)) cell.textContent = '2W';
                else if (TL.some(([tr,tc]) => tr === r && tc === c)) cell.textContent = '3L';
                else if (DL.some(([tr,tc]) => tr === r && tc === c)) cell.textContent = '2L';
                else if (r === 7 && c === 7) cell.textContent = '★';
                else cell.textContent = '';
                
                cell.classList.remove('filled', 'preview');
            }
        }

        function previewMove(move) {
            // Clear previous preview
            for (let r = 0; r < 15; r++) {
                for (let c = 0; c < 15; c++) {
                    updateCell(r, c);
                }
            }
            
            if (!move) return;
            
            // Show new tiles as preview
            for (let i = 0; i < move.word.length; i++) {
                const r = move.d === 'h' ? move.r : move.r + i;
                const c = move.d === 'h' ? move.c + i : move.c;
                
                if (!board[r][c]) {
                    cells[r][c].textContent = move.word[i];
                    cells[r][c].classList.add('preview');
                }
            }
        }

        function clear() {
            board = Array(15).fill().map(() => Array(15).fill(''));
            currentMoves = [];
            activeMove = null;
            init();
            document.getElementById('rack').value = '';
            document.getElementById('results').innerHTML = '';
            document.getElementById('status').innerHTML = '';
        }

        function status(msg, type) {
            document.getElementById('status').innerHTML = `<div class="status ${type}">${msg}</div>`;
        }

        function anchors() {
            const a = [];
            let hasAny = false;
            
            for (let r = 0; r < 15; r++) {
                for (let c = 0; c < 15; c++) {
                    if (board[r][c]) hasAny = true;
                    if (board[r][c] === '') {
                        const h = (c > 0 && board[r][c-1]) || (c < 14 && board[r][c+1]);
                        const v = (r > 0 && board[r-1][c]) || (r < 14 && board[r+1][c]);
                        if (h || v) {
                            a.push({r, c, d: 'h'}, {r, c, d: 'v'});
                        }
                    }
                }
            }
            
            if (!hasAny) {
                a.push({r: 7, c: 7, d: 'h'}, {r: 7, c: 7, d: 'v'});
            }
            
            return a;
        }

        function score(word, r, c, d, tiles) {
            let s = 0, wm = 1;
            for (let i = 0; i < word.length; i++) {
                const rr = d === 'h' ? r : r + i;
                const cc = d === 'h' ? c + i : c;
                let ls = VALUES[word[i]] || 0, lm = 1;
                
                if (tiles.some(t => t.r === rr && t.c === cc)) {
                    if (TW.some(([tr,tc]) => tr === rr && tc === cc)) wm *= 3;
                    else if (DW.some(([tr,tc]) => tr === rr && tc === cc)) wm *= 2;
                    else if (TL.some(([tr,tc]) => tr === rr && tc === cc)) lm = 3;
                    else if (DL.some(([tr,tc]) => tr === rr && tc === cc)) lm = 2;
                }
                s += ls * lm;
            }
            return s * wm + (tiles.length === 7 ? 50 : 0);
        }

        function canForm(word, rack) {
            const r = rack.split('');
            const needed = [];
            
            for (let i = 0; i < word.length; i++) {
                const rr = word.move ? (word.d === 'h' ? word.r : word.r + i) : 0;
                const cc = word.move ? (word.d === 'h' ? word.c + i : word.c) : 0;
                const l = word[i];
                
                if (word.move && board[rr] && board[rr][cc]) continue;
                needed.push(l);
            }
            
            for (let l of needed) {
                const idx = r.indexOf(l);
                if (idx !== -1) r.splice(idx, 1);
                else if (r.includes('?')) r.splice(r.indexOf('?'), 1);
                else return false;
            }
            return true;
        }

        function valid(word, r, c, d) {
            if (r < 0 || c < 0) return false;
            const er = d === 'h' ? r : r + word.length - 1;
            const ec = d === 'h' ? c + word.length - 1 : c;
            if (er >= 15 || ec >= 15) return false;
            
            let conn = false;
            for (let i = 0; i < word.length; i++) {
                const rr = d === 'h' ? r : r + i;
                const cc = d === 'h' ? c + i : c;
                const ex = board[rr][cc];
                if (ex) {
                    if (ex !== word[i]) return false;
                    conn = true;
                }
            }
            
            const empty = board.every(row => row.every(cell => !cell));
            if (!empty && !conn) return false;
            
            if (empty) {
                if (!(r <= 7 && r + (d === 'v' ? word.length : 1) > 7 &&
                      c <= 7 && c + (d === 'h' ? word.length : 1) > 7)) return false;
            }
            
            return true;
        }

        function newTiles(word, r, c, d) {
            const t = [];
            for (let i = 0; i < word.length; i++) {
                const rr = d === 'h' ? r : r + i;
                const cc = d === 'h' ? c + i : c;
                if (!board[rr][cc]) t.push({r: rr, c: cc, l: word[i]});
            }
            return t;
        }

        async function generate(rack, anch) {
            const moves = [];
            const queries = [];
            
            for (let len = 2; len <= 7; len++) {
                queries.push(
                    fetch(`https://api.datamuse.com/words?sp=${'?'.repeat(len)}&max=1000`)
                        .then(r => r.json())
                );
            }
            
            const results = await Promise.all(queries);
            const words = new Set();
            
            results.forEach(list => {
                list.forEach(item => {
                    const w = item.word.toUpperCase();
                    if (w.length >= 2 && w.length <= 7) {
                        words.add(w);
                    }
                });
            });
            
            for (let a of anch) {
                for (let word of words) {
                    for (let off = 0; off < word.length; off++) {
                        const sr = a.d === 'h' ? a.r : a.r - off;
                        const sc = a.d === 'h' ? a.c - off : a.c;
                        
                        if (valid(word, sr, sc, a.d)) {
                            const tiles = newTiles(word, sr, sc, a.d);
                            
                            // Check if we can form this word with our rack
                            const rackNeeded = tiles.map(t => t.l).join('');
                            if (canForm(rackNeeded, rack)) {
                                const s = score(word, sr, sc, a.d, tiles);
                                moves.push({
                                    word,
                                    r: sr,
                                    c: sc,
                                    d: a.d,
                                    score: s,
                                    pos: `${String.fromCharCode(65 + sr)}${sc + 1}`,
                                    tiles: tiles.length
                                });
                            }
                        }
                    }
                }
            }
            
            moves.sort((a, b) => b.score - a.score);
            return moves.slice(0, 50);
        }

        function display(moves) {
            const div = document.getElementById('results');
            if (!moves.length) {
                div.innerHTML = '<div class="status error">No valid moves found</div>';
                return;
            }
            
            currentMoves = moves;
            let html = '<div class="moves">';
            
            moves.forEach((m, i) => {
                html += `
                    <div class="move ${i === 0 ? 'active' : ''}" onclick="selectMove(${i})">
                        <div class="move-rank">${i + 1}</div>
                        <div>
                            <div class="move-word">${m.word}</div>
                            <div class="move-details">
                                ${m.pos} ${m.d === 'h' ? '→' : '↓'} • ${m.tiles} tiles${m.tiles === 7 ? ' • BINGO' : ''}
                            </div>
                        </div>
                        <div class="move-score">${m.score}</div>
                    </div>
                `;
            });
            
            html += '</div>';
            div.innerHTML = html;
            
            // Auto-preview top move
            selectMove(0);
        }

        function selectMove(idx) {
            activeMove = idx;
            previewMove(currentMoves[idx]);
            
            // Update active state
            document.querySelectorAll('.move').forEach((el, i) => {
                el.classList.toggle('active', i === idx);
            });
        }

        async function solve() {
            const rack = document.getElementById('rack').value.trim().toUpperCase();
            if (rack.length < 2 || rack.length > 7) {
                status('Enter 2-7 letters in your rack', 'error');
                return;
            }
            
            status('Analyzing board...', 'processing');
            const a = anchors();
            const moves = await generate(rack, a);
            
            if (moves.length) {
                display(moves);
                status(`Found ${moves.length} moves`, 'success');
            } else {
                status('No valid moves', 'error');
            }
        }

        init();
    </script>
</body>
</html>
